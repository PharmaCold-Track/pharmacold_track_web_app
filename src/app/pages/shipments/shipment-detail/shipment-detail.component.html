<div class="detail-container" *ngIf="shipment() as data">
  <header class="detail-header">
    <div class="header-left">
      <a routerLink="/shipments" class="back-link">← Volver</a>
      <h1>Envío #{{ data.id }}</h1>
      <span class="status-pill" [ngClass]="data.status">{{ data.status }}</span>
    </div>
    <div class="header-right">
      <button class="btn-action" *ngIf="data.status === 'CREATED'">Registrar Salida</button>
      <button class="btn-action" *ngIf="data.status === 'IN_TRANSIT'">Registrar Entrega</button>
    </div>
  </header>

  <div class="dashboard-grid">
    <div class="card temp-card">
      <h3>Temperatura Actual</h3>
      <div class="big-temp" [style.color]="getTempColor(data.currentTemp || 0)">
        {{ data.currentTemp !== null ? data.currentTemp + '°C' : '--' }}
      </div>
      <p class="last-update">Última actualización: Hace un momento</p>
    </div>

    <div class="card map-card">
      <h3>Ubicación en Tiempo Real</h3>
      <div class="map-frame">
        <div class="placeholder-map">
          <i class="fas fa-map-marked-alt"></i>
          <p>Mapa Interactivo (Integración Pendiente)</p>
        </div>
      </div>
    </div>

    <div class="card history-card">
      <h3>Historial Térmico</h3>
      <div class="chart-container">
        <div class="chart-bars">
          <div
            class="bar-wrapper"
            *ngFor="let temp of data.telemetryHistory; let i = index"
            [title]="'Lectura ' + i + ': ' + temp + '°C'"
          >
            <div
              class="bar"
              [style.height]="getBarHeight(temp)"
              [style.background-color]="getTempColor(temp)"
            ></div>
            <span class="bar-label">{{ temp }}°</span>
          </div>

          <div *ngIf="!data.telemetryHistory?.length" class="no-data">
            Sin datos de sensores aún
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="isLoading()" class="loading">Cargando detalles...</div>
